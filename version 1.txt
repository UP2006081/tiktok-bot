import discord
import asyncio
import os
from TikTokApi import TikTokApi

client = discord.Client()

def getrecent():
  os.system('python -m playwright install')

  verifyFp = "verify_kl5bb99h_U3suiDBK_VUg4_4B8o_AFtP_pjCH4anX7nrJ"
  api = TikTokApi.get_instance(custom_verifyFp=verifyFp, use_test_endpoints=True, use_selenium=True)

  n_videos = 1
  username = 'conmiele'
  user_videos = api.byUsername(username, count=n_videos)

  def simple_dict(tiktok_dict):
    user_name = tiktok_dict['author']['uniqueId']
    video_id = tiktok_dict['id']
    returnval = 'https://www.tiktok.com/@{}/video/{}?lang=en'.format(user_name, video_id)
    return returnval

  discordreturn = ""

  for i in user_videos:
    url = []
    for v in simple_dict(i):
      url.append(v)
    discordreturn = ("".join(url))
  return discordreturn

msg = getrecent()

@client.event
async def on_ready():
  print("we have logged in as {0.user}".format(client))

@client.event
async def on_message(message):
  if message.author == client.user:
    return

  if message.content.startswith("%recent"):
    await message.channel.send(msg)

client.run("ODExNjU3Nzg4Mjk1MzQ4Mjk1.YC1ZOA.Fclk0WDyjAz5Mr04fAj3zq1O6b4")